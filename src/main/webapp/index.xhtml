<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>Document Repository</title>
</h:head>

<h:body>
    <h1>Exercise 2: Document Repository</h1>

    <!--Displays messages in an overlay-->
    <p:growl id="growl" showDetail="true" />

    <!-- Menu Section -->
    <h2>Search Menu</h2>    
    <h:form id="searchYearForm">
        <p:panelGrid columns="2">
            <!-- Input Search text-->
            <p:outputLabel for="searchYear" value="Search by Year:" />
            <p:inputText id="searchYear" value="#{DocumentBean.searchYear}" required="true">
                <f:validateLongRange minimum="1000" maximum="#{DocumentBean.currentYear}" />
            </p:inputText>

            <!--Action Buttons-->
            <p:commandButton value="Search" action="#{DocumentBean.listDocumentsByPublicationYear}" update="@form :listForm growl" styleClass="mr-2"/>
            <p:commandButton value="List All Documents" action="#{DocumentBean.listDocumentByTitlesAndYears}" immediate="true" update="@form :listForm growl" styleClass="mr-2 ui-button-warning"/>
        </p:panelGrid>
    </h:form>

    <!-- Document List Section -->
    <h2>Document List</h2>

    <h:form id="listForm" resetValues="true">
        <p:dataTable value="#{DocumentBean.listDocuments}" var="doc" rendered="#{not empty DocumentBean.listDocuments}">
            <p:column>
                <f:facet name="header">Title</f:facet>
                <h:outputText value="#{doc.title}"/>
            </p:column> 
            <p:column>
                <f:facet name="header">Authors</f:facet>
                <h:outputText value="#{doc.authorNames}"/>
            </p:column>
            <p:column>
                <f:facet name="header">Publication Date</f:facet>
                <h:outputText value="#{doc.publicationDate}">
                    <f:convertDateTime pattern="yyyy-MM-dd" />
                </h:outputText>
            </p:column>
            <p:column>
                <f:facet name="header">Details</f:facet>
                <h:inputHidden value="#{doc.id}" id="documentId_#{rowIndex}" />
                <p:commandButton value="View" action="#{DocumentBean.loadDocumentDetails}" >
                    <f:ajax execute="@this" render=":detailsForm growl"/>
                    <f:setPropertyActionListener target="#{DocumentBean.selectedDocumentId}" value="#{doc.id}" />
                </p:commandButton>
            </p:column>
        </p:dataTable>

   
        <p:dataTable value="#{DocumentBean.listAllDocuments}" var="docRow" rowIndexVar="rowIndex" rendered="#{not empty DocumentBean.listAllDocuments}">
            <p:column>
                <f:facet name="header">Title</f:facet>
                <h:outputText value="#{docRow[0]}"/>
            </p:column>
            <p:column>
                <f:facet name="header">Publication Date</f:facet>
                <h:outputText value="#{docRow[1]}">
                    <f:convertDateTime pattern="yyyy-MM-dd" />
                </h:outputText>
            </p:column>
            <p:column>
                <f:facet name="header">Details</f:facet>
                <h:inputHidden value="#{docRow[2]}" id="documentId_#{rowIndex}" />
                <p:commandButton value="View" action="#{DocumentBean.loadDocumentDetails}" >
                    <f:ajax execute="@this" render=":detailsForm growl" />
                    <f:setPropertyActionListener target="#{DocumentBean.selectedDocumentId}" value="#{docRow[2]}" />
                </p:commandButton>
            </p:column>
        </p:dataTable>
    </h:form>

    <!-- Document Details Section -->
    <h2>Document Details</h2>
    <h:form id="detailsForm" resetValues="true">
        <p:panelGrid columns="2" rendered="#{not empty DocumentBean.selectedDocument}">
            <p:outputLabel value="Title:" style="font-weight: bold;" />
            <h:outputText value="#{DocumentBean.selectedDocument.title}" />
            <p:outputLabel value="Abstract:" style="font-weight: bold;"/>
            <h:outputText value="#{DocumentBean.selectedDocument.abstractText}" />
            <p:outputLabel value="Publication Date:" style="font-weight: bold;"/>
            <h:outputText value="#{DocumentBean.selectedDocument.publicationDate}">
                <f:convertDateTime pattern="yyyy-MM-dd" />
            </h:outputText>
            <p:outputLabel value="Publisher:" style="font-weight: bold;"/>
            <h:outputText value="#{DocumentBean.selectedDocument.publisher}" />
            <p:outputLabel value="Storage Location:" style="font-weight: bold;" />
            <h:outputText value="#{DocumentBean.selectedDocument.storageLocation}" />
            <p:outputLabel value="Authors:" style="font-weight: bold;" />
            <h:outputText value="#{DocumentBean.selectedDocument.authorNames}" />
        </p:panelGrid>
    </h:form>

</h:body>

</html>
